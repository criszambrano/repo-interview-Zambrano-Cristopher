<div class="page-container">
  <header class="header">
    <div class="logo">BANCO</div>
    <a routerLink="/add" class="btn-primary">Agregar</a>
  </header>

  <main class="main-content">
    <section class="search-section">
      <input
        type="text"
        placeholder="Search..."
        [ngModel]="searchTerm()"
        (ngModelChange)="onSearchChange($event)"
        class="form-control"
      />
    </section>

    @if (!loading() && totalResults() > 0) {
      <section class="toolbar">
        <span class="results-count">{{ totalResults() }} resultados</span>
        <select class="form-select-sm" [ngModel]="pageSize()" (change)="onPageSizeChange($event)">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="20">20</option>
        </select>
      </section>
    }

    <div class="table-wrapper">
      <table class="table">
        <thead>
          <tr>
            <th>Logo</th>
            <th>Nombre del producto</th>
            <th>Descripción</th>
            <th>Fecha de liberación</th>
            <th>Fecha de revisión</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          @if (loading()) {
            @for (i of [1,2,3,4,5,6,7,8,9,10]; track i) {
              <tr class="skeleton-row">
                <td><div class="skeleton-logo"></div></td>
                <td><div class="skeleton-text long"></div></td>
                <td><div class="skeleton-text medium"></div></td>
                <td><div class="skeleton-text short"></div></td>
                <td><div class="skeleton-text short"></div></td>
                <td><div class="skeleton-dots"></div></td>
              </tr>
            }
          }

          @if (error()) {
            <tr><td colspan="6" class="text-danger text-center py-5">Error al cargar productos</td></tr>
          }

          @if (!loading() && totalResults() === 0) {
            <tr><td colspan="6" class="text-muted text-center py-5">No se encontraron productos</td></tr>
          }

          @for (product of paginatedProducts(); track product.id) {
            <tr>
              <td><img [src]="product.logo" alt="Logo" class="product-logo" /></td>
              <td class="fw-medium">{{ product.name }}</td>
              <td class="text-muted">{{ product.description }}</td>
              <td>{{ product.date_release | date:'dd/MM/yyyy' }}</td>
              <td>{{ product.date_revision | date:'dd/MM/yyyy' }}</td>
              <td class="text-center text-muted fs-4">⋮</td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    @if (!loading() && totalResults() > 0) {
      <footer class="table-footer">
      <span class="results-count">{{ totalResults() }} resultados</span>

        <div class="pagination-compact">
          <button class="btn-pagination" (click)="goToPage(currentPage() - 1)" [disabled]="currentPage() === 1">←</button>
          
          <select class="form-select-sm" [value]="currentPage()" (change)="goToPage(+$any($event.target).value)">
            @for (page of pageNumbers(); track page) {
              <option [value]="page">{{ page }}</option>
            }
          </select>

          <span class="text-muted mx-2">de {{ totalPages() }}</span>
          
          <button class="btn-pagination" (click)="goToPage(currentPage() + 1)" [disabled]="currentPage() === totalPages()">→</button>
        </div>
      </footer>
    }
  </main>
</div>