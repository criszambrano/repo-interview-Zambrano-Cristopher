<div class="page-container">
  <main class="main-content">
    <div class="table-header">
      <section class="search-section">
        <input
          type="text"
          placeholder="Buscar..."
          [ngModel]="searchTerm()"
          (ngModelChange)="onSearchChange($event)"
          class="form-control"
        />
      </section>
      <div>
        <button class="btn-primary" (click)="onAdd()">Agregar</button>
      </div>
    </div>

    <div class="table-wrapper">
      <div class="table-header-row">
        <div class="th">Logo</div>
        <div class="th">Nombre del producto</div>
        <div class="th">Descripción</div>
        <div class="th">Fecha de liberación</div>
        <div class="th">Fecha de revisión</div>
        <div class="th"></div>
      </div>
      @if (loading()) { @for (i of [1,2,3,4,5,6,7,8,9,10]; track i) {
      <div class="product-card skeleton">
        <div class="skeleton-logo"></div>
        <div class="product-info">
          <div class="skeleton-text long"></div>
          <div class="skeleton-text medium"></div>
        </div>
        <div class="dates">
          <div class="skeleton-text short"></div>
          <div class="skeleton-text short"></div>
        </div>
        <div class="options-cell"><div class="skeleton-dots"></div></div>
      </div>
      } } @if (error()) {
      <div class="empty-state">
        <p class="text-danger">Error al cargar productos</p>
      </div>
      } @if (!loading() && totalResults() === 0) {
      <div class="empty-state">
        <p class="text-muted">No se encontraron productos</p>
      </div>
      } @for (product of paginatedProducts(); track product.id) {
      <div class="product-card">
        <img [src]="product.logo" alt="Logo" class="product-logo" />

        <div class="product-info name-cell">
          <div class="product-name">{{ product.name }}</div>
        </div>

        <div class="description-cell">
          <p class="description">{{ product.description }}</p>
        </div>

        <div class="dates">
          <div>{{ product.date_release | date : 'dd/MM/yyyy' }}</div>
        </div>

        <div class="dates">
          <div>{{ product.date_revision | date : 'dd/MM/yyyy' }}</div>
        </div>

        <div class="options-cell">
          <button class="options-button" (click)="toggleMenu($event, product.id)">⋮</button>

          @if (openMenuId() === product.id) {
          <div class="options-menu" (click)="$event.stopPropagation()">
            <button class="menu-item" (click)="onEdit(product.id)">Editar</button>
            <button class="menu-item text-danger" (click)="openDeleteModal($event, product.id)">
              Eliminar
            </button>
          </div>
          }
        </div>
      </div>
      } @if (!loading() && totalResults() > 0) {
      <footer class="table-footer">
        <span class="results-count">{{ totalResults() }} resultados</span>

        <div class="pagination-compact">
          <button
            class="btn-pagination"
            (click)="goToPage(currentPage() - 1)"
            [disabled]="currentPage() === 1"
          >
            ←
          </button>

          <select
            class="form-select-sm"
            [value]="currentPage()"
            (change)="goToPage(+$any($event.target).value)"
          >
            @for (page of pageNumbers(); track page) {
            <option [value]="page">{{ page }}</option>
            }
          </select>
          <button
            class="btn-pagination"
            (click)="goToPage(currentPage() + 1)"
            [disabled]="currentPage() === totalPages()"
          >
            →
          </button>
        </div>

        <section class="toolbar">
          <select class="form-select-sm" [ngModel]="pageSize()" (change)="onPageSizeChange($event)">
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="20">20</option>
          </select>
        </section>
      </footer>
      }
    </div>
  </main>

  @if (deleteCandidate()) {
  <div class="modal-overlay" (click)="cancelDelete()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <p>
        ¿Estás seguro de eliminar el producto
        <strong>{{ deleteProductName() }}</strong
        >?
      </p>
      <div class="modal-actions">
        <button class="btn-secondary" (click)="cancelDelete()">Cancelar</button>
        <button class="btn-primary" (click)="confirmDelete()">Confirmar</button>
      </div>
    </div>
  </div>
  }
</div>
